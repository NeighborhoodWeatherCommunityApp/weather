<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>날씨 대시보드</title>
    <!-- CSS only -->
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"-->
    <!--          rel="stylesheet"-->
    <!--          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"-->
    <!--          crossorigin="anonymous">-->
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">

    <!-- Icons -->
    <link th:href="@{/static/assets/css/nucleo-icons.css}" rel="stylesheet"/>
    <link th:href="@{/static/assets/css/nucleo-svg.css}" rel="stylesheet"/>

    <!-- CSS Files -->
    <link id="pagestyle" th:href="@{/static/assets/css/argon-dashboard.css}" rel="stylesheet"/>
</head>

<body class="g-sidenav-show bg-gray-100" th:classappend="${bodyClass}">
<div class="min-height-300 bg-primary position-absolute w-100"></div>
<!-- Sidebar -->
<aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4"
       id="sidenav-main">
    <!-- Sidebar content -->
</aside>
<main class="main-content position-relative border-radius-lg">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur"
         navbar-scroll="true">
        <!-- Navbar content -->
    </nav>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">공유된 날씨 수</p>
                                    <h5 class="font-weight-bolder" th:text="${sharedWeatherCount}">123</h5>
                                    <p class="mb-0">
                                        <span class="text-success text-sm font-weight-bolder"
                                              th:text="${sharedWeatherIncrease}">+55%</span>
                                        <span th:text="${sharedWeatherPeriod}">since 1 hour</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                                    <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">최다 응답</p>
                                    <h5 class="font-weight-bolder" th:text="${mostSelectTempTag}"></h5>
                                    <p class="mb-0">
                                        <span class="text-success text-sm font-weight-bolder"
                                              th:text="${countUser}"></span>
                                        명의 사용자들이
                                        <span class="text-success text-sm font-weight-bolder"
                                              th:text="${mostSelectTempTag}"></span>
                                        고 느끼고 있습니다.
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                                    <i class="ni ni-world text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">최다 유형</p>
                                    <h5 class="font-weight-bolder">
                                        보통 유형
                                    </h5>
                                    <p class="mb-0">
                                        <span class="text-success text-sm font-weight-bolder">37</span>
                                        명이 보통 유형을 선택했습니다.
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                                    <i class="ni ni-world text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-lg-7 mb-lg-0 mb-4">
                    <div class="card z-index-2 h-100">
                        <div class="card-header pb-0 pt-3 bg-transparent">
                            <h6 class="text-capitalize">시간대별 응답</h6>
                            <p class="text-sm mb-0">
                                <span class="font-weight-bold">유형</span>
                            </p>
                            <button type="button" class="btn btn-default" onclick="updateChart(0)">ALL</button>
                            <button type="button" class="btn btn-info" onclick="updateChart(1)">추위</button>
                            <button type="button" class="btn btn-success" onclick="updateChart(2)">보통</button>
                            <button type="button" class="btn btn-danger" onclick="updateChart(3)">더위</button>
                        </div>
                        <div class="card-body p-3">
                            <div class="chart">
                                <canvas id="chart-line" class="chart-canvas" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="card card-carousel overflow-hidden h-100 p-0">
                        <div id="carouselExampleCaptions" class="carousel slide h-100" data-bs-ride="carousel">
                            <div class="carousel-inner border-radius-lg h-100">
                                <div class="carousel-item h-100" style="background-image: url('/static/assets/img/carousel-1.jpg');
      background-size: cover;">
                                    <div class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5">
                                        <div class="icon icon-shape icon-sm bg-white text-center border-radius-md mb-3">
                                            <i class="ni ni-camera-compact text-dark opacity-10"></i>
                                        </div>
                                        <h5 class="text-white mb-1">Get started with Argon</h5>
                                        <p>There’s nothing I really wanted to do in life that I wasn’t able to get good
                                            at.</p>
                                    </div>
                                </div>
                                <div class="carousel-item h-100" style="background-image: url('static/assets/img/carousel-2.jpg');
      background-size: cover;">
                                    <div class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5">
                                        <div class="icon icon-shape icon-sm bg-white text-center border-radius-md mb-3">
                                            <i class="ni ni-bulb-61 text-dark opacity-10"></i>
                                        </div>
                                        <h5 class="text-white mb-1">Faster way to create web pages</h5>
                                        <p>That’s my skill. I’m not really specifically talented at anything except for
                                            the ability to learn.</p>
                                    </div>
                                </div>
                                <div class="carousel-item h-100 active" style="background-image: url('static/assets/img/carousel-3.jpg');
      background-size: cover;">
                                    <div class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5">
                                        <div class="icon icon-shape icon-sm bg-white text-center border-radius-md mb-3">
                                            <i class="ni ni-trophy text-dark opacity-10"></i>
                                        </div>
                                        <h5 class="text-white mb-1">Share with us your design tips!</h5>
                                        <p>Don’t be afraid to be wrong because you can’t learn anything from a
                                            compliment.</p>
                                    </div>
                                </div>
                            </div>
                            <button class="carousel-control-prev w-5 me-3" type="button"
                                    data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next w-5 me-3" type="button"
                                    data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <footer class="footer pt-3">
                <!-- Footer content -->
            </footer>
        </div>
    </div>
</main>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/perfect-scrollbar@1.5.0/dist/perfect-scrollbar.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:src="@{/static/assets/js/argon-dashboard.min.js}"></script>

<!-- Font Awesome Icons -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous">
</script>
<script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
<!-- Core -->
<script th:src="@{/static/assets/js/core/popper.min.js}"></script>
<script th:src="@{/static/assets/js/core/bootstrap.min.js}"></script>


<script th:inline="javascript">
    var Charts = {
        colors: {
            gray: {
                100: '#f6f9fc',
                200: '#e9ecef',
                300: '#dee2e6',
                400: '#ced4da',
                500: '#adb5bd',
                600: '#8898aa',
                700: '#525f7f',
                800: '#32325d',
                900: '#212529'
            },
            theme: {
                'default': '#172b4d',
                'primary': '#5e72e4',
                'secondary': '#f4f5f7',
                'info': '#11cdef',
                'success': '#2dce89',
                'danger': '#f5365c',
                'warning': '#fb6340'
            }
        }
    };

    function updateChart(sensitivity) {
        $.ajax({
            url: '/api/dashboard/chart-data',
            method: 'GET',
            data: {sensitivity: sensitivity},
            success: function (response) {
                chartLine.data.labels = response.times;
                chartLine.data.datasets[0].data = response.temps;
                chartLine.data.datasets[1].data = response.tagData1;
                chartLine.data.datasets[2].data = response.tagData2;
                chartLine.data.datasets[3].data = response.tagData3;

                chartLine.data.datasets[1].label = response.tag1;
                chartLine.data.datasets[2].label = response.tag2;
                chartLine.data.datasets[3].label = response.tag3;

                chartLine.update();
            },
            error: function (xhr, status, error) {
                console.error("Error fetching chart data:", error);
            }
        });
    }

    $(document).ready(function () {
        var ctx = document.getElementById('chart-line').getContext('2d');
        var chartLine = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    type: 'line',
                    label: '온도',
                    data: [],
                    borderColor: Charts.colors.theme['primary'],
                    backgroundColor: 'rgba(94, 114, 228, 0.1)',
                    yAxisID: 'y-axis-temp'
                }, {
                    type: 'bar',
                    label: '',
                    data: [],
                    backgroundColor: Charts.colors.theme['danger'],
                    yAxisID: 'y-axis-count'
                }, {
                    type: 'bar',
                    label: '',
                    data: [],
                    backgroundColor: Charts.colors.theme['warning'],
                    yAxisID: 'y-axis-count'
                }, {
                    type: 'bar',
                    label: '',
                    data: [],
                    backgroundColor: Charts.colors.theme['success'],
                    yAxisID: 'y-axis-count'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {stacked: true},
                    'y-axis-temp': {
                        type: 'linear',
                        position: 'left',
                        ticks: {
                            callback: function (value) {
                                return value + '°C';
                            }
                        }
                    },
                    'y-axis-count': {
                        type: 'linear',
                        position: 'right',
                        stacked: true,
                        ticks: {
                            beginAtZero: true
                        }
                    }
                }
            }
        });

        // 초기 차트 데이터 로드
        updateChart(0);

        // 버튼 클릭 이벤트 핸들러
        $('button[data-type]').on('click', function () {
            var sensitivity = $(this).data('type');
            updateChart(sensitivity);
        });
    });
</script>

</body>

</html>
